{% extends "layouts/layout.njk" %}

{% block scripts %}
    
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="/build/assets/js/jSignature.min.js"></script>
    <script>
        var signaturePad = null;
        $(document).ready(function() {
            signaturePad = $("#signature_pad");
            signaturePad.jSignature({width: 600, height: 200});
        })

        function signatureDraw() {
            $('#signature_draw').show();
            $('#signature_type').hide();
        };

        function signatureType() {
            $('#signature_draw').hide();
            $('#signature_type').show();
        };

        function switchSignatureMode() {
            let value = $('input[type=radio][name=signature_mode]:checked')[0].value;
            if(value === 'draw'){
                signatureDraw();
            }
            else {
                signatureType();
            }    
        };

        $('input[type=radio][name=signature_mode]').change(switchSignatureMode);
        switchSignatureMode();

    </script>
{% endblock %}

{% block content %}

    <h1>{{ __('consent.title') }}</h1>

    <p>{{ __('consent.preamble') }}</p>
    
    <p class="font-bold">{{ __('consent.may_contact_preamble') }}</p>
    <ul>
        <li>{{ __('consent.practioners') }}</li>
        <li>{{ __('consent.facilities') }}</li>
        <li>{{ __('consent.government') }}</li>
        <li>{{ __('consent.compensation_boards') }}</li>
        <li>{{ __('consent.employers') }}</li>
        <li>{{ __('consent.insurers') }}</li>
    </ul>

    <form action="{{ route('consent.store') }}" method="post">
        <input type="hidden" name="_csrf" value="{{ _csrf }}">

        {{ 
            checkBoxes(
                'consent_optional_parties', 
                {
                    'education': 'consent.education', 
                    'accountant':'consent.accountant',
                    'financial': 'consent.financial',
                    'volunteer': 'consent.volunteer',
                    'employees': 'consent.employees'
                }, 
                [
                    'education', 
                    'accountant',
                    'financial',
                    'volunteer',
                    'employees'
                ], 
                'consent.optional_parties_preamble', 
                errors, 
                {}
            ) 
        }}

        {{ radioButtons(
                'consent',
                {
                    'yes': 'consent.yes',
                    'no': 'consent.no'
                },
                null,
                'consent.question',
                errors,
                {
                    'safe': true
                }
            )
        }}

        {{ radioButtons(
                'signature_mode',
                {
                    'draw': 'consent.signature_draw',
                    'type': 'consent.signature_type'
                },
                'draw',
                'consent.signature_option',
                errors,
                {
                    'required': true
                }
            )
        }}


        <div id="signature_draw">
            <label>
                <span aria-hidden="true" class="required">*</span>
                {{ __('consent.signature_draw_instructions') }}
                <span class="required">{{ __('required') }}</span>
            </label>
            <div id="signature_draw" class="relative w-3-4 border-2 border-black">
                <div id="signature_pad_clear" class="bottom-0 w-full text-right pr-4 pt-4 leading-none">
                    <a onclick="signaturePad.jSignature('clear')" class="no-underline text-gray-500">Clear</a>
                </div>
                <div id="signature_pad" class="overflow-hidden"></div>
                <div id="signature_pad_line" class="absolute bottom-0 p-4 pb-16 pointer-events-none w-full">
                    <div class="border-b border-gray-500 text-gray-500">x</div>
                </div>
            </div>
        </div>

        <div id="signature_type" class="hidden">
            {{ textInput('signature', 'consent.signature_type_instructions', {'required': true} ) }}
        </div>

        <p>{{ __('section2.consent_valid_period') }}</p>

        {{ formButtons() }}
    </form>

{% endblock %}
