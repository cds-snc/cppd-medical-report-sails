{% extends "layouts/layout.njk" %}

{% block scripts %}
    {# The signature pad uses jQuery and a jQuery plugin called jSignature #}
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="/build/assets/js/jSignature.min.js"></script>
    
    {# These scripts control showing/hiding of signature modes, and collecting drawing data #}
    <script>
        function signatureDraw() {
            $('#signature_draw').show();
            $('#signature_type').hide();
        };

        function signatureType() {
            $('#signature_draw').hide();
            $('#signature_type').show();
        };

        function switchSignatureMode() {
            let value = $('input[type=radio][name=signature_mode]:checked')[0].value;
            if(value === 'draw'){
                signatureDraw();
            }
            else {
                signatureType();
            }    
        };

        function encodeSignatureDrawing() {
            let data = $('#signature_pad').jSignature('getData', 'svg');
            $('#signature_draw_data').val(data);
        };

        $(document).ready(function() {
            let signaturePad = $("#signature_pad");
            signaturePad.jSignature({width: 600, height: 200});

            $('input[type=radio][name=signature_mode]').change(switchSignatureMode);
            switchSignatureMode();

            signaturePad.change(encodeSignatureDrawing);
        });

    </script>
{% endblock %}

{% block content %}

    <h1>{{ __('consent.title') }}</h1>

    <p>{{ __('consent.preamble') }}</p>
    
    <p class="font-bold">{{ __('consent.may_contact_preamble') }}</p>
    <ul>
        <li>{{ __('consent.practioners') }}</li>
        <li>{{ __('consent.facilities') }}</li>
        <li>{{ __('consent.government') }}</li>
        <li>{{ __('consent.compensation_boards') }}</li>
        <li>{{ __('consent.employers') }}</li>
        <li>{{ __('consent.insurers') }}</li>
    </ul>

    <form action="{{ route('consent.store') }}" method="post" class="w-full">
        <input type="hidden" name="_csrf" value="{{ _csrf }}">

        {{ 
            checkBoxes(
                'consent_optional_parties', 
                {
                    'education': 'consent.education', 
                    'accountant':'consent.accountant',
                    'financial': 'consent.financial',
                    'volunteer': 'consent.volunteer',
                    'employees': 'consent.employees'
                }, 
                [
                    'education', 
                    'accountant',
                    'financial',
                    'volunteer',
                    'employees'
                ], 
                'consent.optional_parties_preamble', 
                errors, 
                {}
            ) 
        }}

        <div class="border border-gray-600 border-solid bg-gray-100 p-8">
            {{ radioButtons(
                    'consent',
                    {
                        'yes': 'consent.yes',
                        'no': 'consent.no'
                    },
                    null,
                    'consent.question',
                    errors,
                    {
                        'safe': true
                    }
                )
            }}

            <table class="md:ml-12 align-top text-lg">
                <tr>
                    <td class="align-top">
                        <svg class="h-8 w-8 inline" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M19.511 17.98L10.604 1.348a.697.697 0 0 0-1.208 0L.49 17.98a.675.675 0 0 0 .005.68c.125.211.352.34.598.34h17.814a.694.694 0 0 0 .598-.34.677.677 0 0 0 .006-.68zM11 17H9v-2h2v2zm0-3.5H9V7h2v6.5z"></svg>
                    </td>
                    <td class="md:pl-2">
                        {{  __('consent.i_understand_intro') }}
                        <ul class="pl-5">
                            <li>{{  __('consent.i_understand_1') }}</li>
                            <li>{{  __('consent.i_understand_2') }}</li>
                            <li>{{  __('consent.i_understand_3') }}</li>
                        </ul>
                    </td>
                    <tr/>
            </table>

            <br/>

            {{ radioButtons(
                    'signature_mode',
                    {
                        'draw': 'consent.signature_draw',
                        'type': 'consent.signature_type'
                    },
                    'draw',
                    'consent.signature_option',
                    errors,
                    {
                        'required': true
                    }
                )
            }}

            <br/>

            <div id="signature_draw">
                <label>
                    <span aria-hidden="true" class="required">*</span>
                    {{ __('consent.signature_draw_instructions') }}
                    <span class="required">{{ __('required') }}</span>
                </label>
                <div id="signature_draw" class="relative w-3-4 border-2 border-black">
                    <div id="signature_pad_clear" class="bottom-0 w-full text-right pr-4 pt-4 leading-none bg-white">
                        <a onclick="$('#signature_pad').jSignature('clear')" class="no-underline text-gray-500">Clear</a>
                    </div>
                    <div id="signature_pad" class="overflow-hidden bg-white"></div>
                    <div id="signature_pad_line" class="absolute bottom-0 p-4 pb-16 pointer-events-none w-full">
                        <div class="border-b border-gray-500 text-gray-500">x</div>
                    </div>
                </div>
                <input id="signature_draw_data" name="signature_draw_data" type="hidden"/>
            </div>

            <div id="signature_type" class="hidden">
                {{ textInput('signature', 'consent.signature_type_instructions', {'required': true} ) }}
            </div>
        </div>

        <p>{{ __('consent.valid_period') }}<a href="{{ __('consent.cancel_consent_link') }}">{{ __('consent.cancel_in_writing') }}</a></p>


        {{ formButtons() }}
    </form>
{% endblock %}
